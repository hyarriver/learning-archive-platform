<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习资料聚合平台</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- shadcn/ui 组件样式 -->
    <link rel="stylesheet" href="/components/ui-components.css">
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <!-- Tailwind CSS Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                },
            },
        }
    </script>
    <!-- Custom CSS Variables -->
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
            --radius: 0.75rem;
        }
        
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --primary: 217.2 91.2% 59.8%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 224.3 76.3% 48%;
        }
        
        /* 暗夜模式平滑过渡效果 */
        * {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        
        /* 对于背景色，使用更平滑的过渡 */
        body, html {
            transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 按钮和交互元素的过渡 */
        button, a, input, select, textarea {
            transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                       color 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                       border-color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                       box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                       transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 卡片和容器元素的过渡 */
        .bg-card, .border-border, [class*="bg-"] {
            transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                       border-color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                       box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 全局优化 */
        body {
            font-feature-settings: "rlig" 1, "calt" 1;
        }
        
        /* Markdown 样式 - 统一风格 */
        .markdown-content {
            line-height: 1.8;
            color: hsl(var(--foreground));
            font-size: 0.95rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: none;
        }
        
        /* Markdown 容器样式 */
        .markdown-wrapper {
            width: 100%;
        }
        
        /* 代码内容容器 */
        .code-content-wrapper {
            width: 100%;
        }
        
        .text-content-wrapper {
            width: 100%;
        }
        .markdown-content h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: hsl(var(--foreground));
            border-bottom: 2px solid hsl(var(--border));
            padding-bottom: 0.5rem;
        }
        .markdown-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.625rem;
            color: hsl(var(--foreground));
            border-bottom: 1px solid hsl(var(--border));
            padding-bottom: 0.375rem;
        }
        .markdown-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground));
        }
        .markdown-content h4 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 0.875rem;
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground));
        }
        .markdown-content p {
            margin-bottom: 1rem;
            color: hsl(var(--foreground));
        }
        .markdown-content ul, .markdown-content ol {
            margin-bottom: 1rem;
            padding-left: 1.75rem;
            color: hsl(var(--foreground));
        }
        .markdown-content li {
            margin-bottom: 0.5rem;
        }
        .markdown-content code {
            background-color: hsl(var(--muted));
            color: hsl(var(--foreground));
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.875em;
        }
        .markdown-content pre {
            background-color: hsl(var(--muted));
            border: 1px solid hsl(var(--border));
            border-radius: 0.75rem;
            padding: 1.25rem;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            position: relative;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        
        /* 代码块在移动端的优化 */
        @media (max-width: 640px) {
            .markdown-content pre {
                padding: 0.75rem;
                font-size: 0.875rem;
                border-radius: 0.375rem;
            }
        }
        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
            color: hsl(var(--foreground));
        }
        .markdown-content blockquote {
            border-left: 4px solid hsl(var(--primary));
            padding-left: 1rem;
            margin-left: 0;
            margin-bottom: 1rem;
            color: hsl(var(--muted-foreground));
            background-color: hsl(var(--muted));
            padding: 0.75rem 1rem;
            border-radius: 0.25rem;
        }
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            border: 1px solid hsl(var(--border));
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .markdown-content table th,
        .markdown-content table td {
            border: 1px solid hsl(var(--border));
            padding: 0.75rem;
            text-align: left;
        }
        .markdown-content table th {
            background-color: hsl(var(--muted));
            font-weight: 600;
            color: hsl(var(--foreground));
        }
        .markdown-content table td {
            color: hsl(var(--foreground));
        }
        /* 移除超链接的可点击功能，保留文本样式 */
        .markdown-content a {
            color: hsl(var(--foreground));
            text-decoration: none;
            pointer-events: none;
            cursor: default;
        }
        .markdown-content a:hover {
            text-decoration: none;
        }
        
        /* 目录相关样式 - 默认隐藏 */
        .markdown-content .toc-section-hidden,
        .markdown-content .toc-item-hidden,
        .markdown-content .toc-link-hidden,
        .markdown-content .toc-section,
        .markdown-content .toc-item,
        .markdown-content .toc-anchor {
            display: none !important;
        }
        /* 图片样式 */
        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            margin: 2rem auto;
            border: 1px solid hsl(var(--border));
            display: block;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .markdown-content img:hover {
            transform: scale(1.01);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        
        /* 响应式图片 */
        @media (max-width: 640px) {
            .markdown-content img {
                margin: 1rem auto;
                border-radius: 0.375rem;
            }
        }
        
        /* 代码块容器样式 */
        .code-content {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        
        /* 分类折叠样式 */
        .category-toggle-btn {
            user-select: none;
            cursor: pointer;
        }
        
        .category-content {
            transition: max-height 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
        }
        
        .category-content.hidden {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        
        .category-icon {
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }
        
        /* 文件卡片优化 */
        .card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* 按钮优化 */
        .btn {
            cursor: pointer;
            user-select: none;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        /* 搜索框优化 */
        #search-input {
            transition: all 0.2s ease;
        }
        
        #search-input:focus {
            transform: scale(1.01);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* 分页按钮优化 */
        #pagination button {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #pagination button:hover:not(.active):not(:disabled) {
            background-color: hsl(var(--accent));
            transform: translateY(-1px);
        }
        
        /* 空状态优化 */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: hsl(var(--muted-foreground));
        }
        
        /* 加载状态优化 */
        .loading-state {
            text-align: center;
            padding: 4rem 2rem;
            color: hsl(var(--muted-foreground));
        }
    </style>
</head>
<body class="bg-background text-foreground">
    <div id="app" class="min-h-screen">
        <!-- 登录/注册页面 -->
        <div id="auth-page" class="flex items-center justify-center min-h-screen p-4 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
            <div class="w-full max-w-md space-y-6">
                <div class="text-center space-y-3">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-primary/80 mb-2 shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent">学习资料聚合平台</h1>
                    <p class="text-muted-foreground">登录或注册账户以继续</p>
                </div>
                
                <!-- 登录表单 -->
                <div id="login-form-container" class="bg-card/80 backdrop-blur-sm border border-border rounded-xl p-8 shadow-xl shadow-black/5 dark:shadow-black/20">
                    <h2 class="text-2xl font-semibold mb-4">登录</h2>
                    <form id="login-form" class="space-y-4">
                        <div class="space-y-2">
                            <label for="login-username" class="label">用户名</label>
                            <input 
                                type="text" 
                                id="login-username" 
                                name="username" 
                                required
                                class="input"
                                placeholder="输入用户名"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="login-password" class="label">密码</label>
                            <input 
                                type="password" 
                                id="login-password" 
                                name="password" 
                                required
                                class="input"
                                placeholder="输入密码"
                            />
                        </div>
                        <div id="login-error" class="text-sm text-destructive hidden"></div>
                        <button 
                            type="submit"
                            class="btn btn-primary w-full"
                        >
                            登录
                        </button>
                    </form>
                    <div class="mt-4 text-center text-sm">
                        <span class="text-muted-foreground">还没有账户？</span>
                        <button id="show-register" class="text-primary hover:underline font-medium">立即注册</button>
                    </div>
                </div>

                <!-- 注册表单 -->
                <div id="register-form-container" class="bg-card/80 backdrop-blur-sm border border-border rounded-xl p-8 shadow-xl shadow-black/5 dark:shadow-black/20 hidden">
                    <h2 class="text-2xl font-semibold mb-4">注册</h2>
                    <form id="register-form" class="space-y-4">
                        <div class="space-y-2">
                            <label for="register-username" class="label">用户名</label>
                            <input 
                                type="text" 
                                id="register-username" 
                                name="username" 
                                required
                                minlength="3"
                                maxlength="50"
                                class="input"
                                placeholder="输入用户名（3-50个字符）"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="register-password" class="label">密码</label>
                            <input 
                                type="password" 
                                id="register-password" 
                                name="password" 
                                required
                                minlength="6"
                                maxlength="100"
                                class="input"
                                placeholder="输入密码（至少6个字符）"
                            />
                        </div>
                        <div id="register-error" class="text-sm text-destructive hidden"></div>
                        <button 
                            type="submit"
                            class="btn btn-primary w-full"
                        >
                            注册
                        </button>
                    </form>
                    <div class="mt-4 text-center text-sm">
                        <span class="text-muted-foreground">已有账户？</span>
                        <button id="show-login" class="text-primary hover:underline font-medium">立即登录</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主页面 -->
        <div id="main-page" class="hidden">
            <header class="border-b border-border bg-card/80 backdrop-blur-sm sticky top-0 z-40 shadow-sm">
                <div class="container mx-auto px-4 py-4 flex items-center justify-between max-w-7xl">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-primary/80 shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent">学习资料聚合平台</h1>
                    </div>
                    <div class="flex items-center gap-2 sm:gap-4">
                        <button 
                            id="theme-toggle-btn"
                            class="btn btn-secondary btn-icon"
                            aria-label="切换主题"
                            title="切换暗夜模式"
                        >
                            <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                            <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                        </button>
                        <span id="current-user" class="text-sm text-muted-foreground hidden sm:inline"></span>
                        <span id="user-role" class="text-xs px-2 py-1 rounded-full bg-secondary text-secondary-foreground hidden sm:inline"></span>
                        <button 
                            id="logout-btn"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-secondary text-secondary-foreground hover:bg-secondary/80 h-9 px-3 sm:px-4"
                        >
                            <span class="hidden sm:inline">退出</span>
                            <span class="sm:hidden">✕</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="container mx-auto px-4 py-6 max-w-7xl">
                <div class="flex flex-col sm:flex-row gap-6">
                    <!-- 侧边栏 -->
                    <aside class="w-full sm:w-64 space-y-1">
                        <nav class="flex flex-row sm:flex-col space-x-2 sm:space-x-0 sm:space-y-2 overflow-x-auto pb-2 sm:pb-0">
                            <a href="#" class="nav-item flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-accent hover:text-accent-foreground active whitespace-nowrap cursor-pointer transition-all duration-200 active:bg-primary active:text-primary-foreground" data-page="files">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                文件列表
                            </a>
                            <a href="#" class="nav-item flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-accent hover:text-accent-foreground admin-only hidden whitespace-nowrap cursor-pointer transition-all duration-200 active:bg-primary active:text-primary-foreground" data-page="collection">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                采集管理
                            </a>
                            <a href="#" class="nav-item flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-accent hover:text-accent-foreground admin-only hidden whitespace-nowrap cursor-pointer transition-all duration-200 active:bg-primary active:text-primary-foreground" data-page="users">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                用户管理
                            </a>
                        </nav>
                    </aside>

                    <!-- 内容区 -->
                    <main class="flex-1">
                        <!-- 文件列表页 -->
                        <div id="files-page" class="content-page">
                            <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                                <h2 class="text-2xl font-semibold">文件列表</h2>
                                <div class="flex flex-wrap gap-2">
                                    <input 
                                        type="text" 
                                        id="search-input" 
                                        placeholder="搜索文件..." 
                                        class="flex h-10 w-full sm:w-64 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                    />
                        <button 
                            id="search-btn"
                            class="inline-flex items-center gap-2 justify-center rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105 h-10 px-4 cursor-pointer"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            搜索
                        </button>
                                    <button 
                                        id="upload-file-page-btn"
                                        class="inline-flex items-center gap-2 justify-center rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105 h-10 px-4 cursor-pointer"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                        上传文件
                                    </button>
                                </div>
                            </div>
                            <!-- 批量操作栏（仅管理员可见） -->
                            <div id="bulk-actions-bar" class="mb-4 hidden admin-only p-3 bg-accent rounded-lg flex items-center justify-between gap-3">
                                <div class="flex items-center gap-3">
                                    <button 
                                        id="select-all-btn"
                                        onclick="selectAllFiles()"
                                        class="text-sm text-foreground hover:underline"
                                    >
                                        全选/取消全选
                                    </button>
                                    <span class="text-sm text-muted-foreground" id="selected-count"></span>
                                </div>
                                <button 
                                    id="bulk-delete-btn"
                                    onclick="bulkDeleteFiles()"
                                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-9 px-4"
                                >
                                    批量删除
                                </button>
                            </div>
                            <div id="files-list" class="space-y-2">
                                <div class="text-center py-8 text-muted-foreground">加载中...</div>
                            </div>
                            <div id="pagination" class="mt-4"></div>
                        </div>

                        <!-- 文件详情页 -->
                        <div id="file-detail-page" class="content-page hidden">
                            <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                <div class="flex items-center gap-3 sm:gap-4">
                                    <button 
                                        id="back-btn"
                                        class="btn btn-secondary btn-sm cursor-pointer"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                        </svg>
                                        返回
                                    </button>
                                    <h2 id="file-title" class="text-xl sm:text-2xl font-semibold truncate flex-1 bg-gradient-to-r from-slate-900 to-slate-700 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent"></h2>
                                </div>
                                <button 
                                    id="download-btn"
                                    class="btn btn-primary w-full sm:w-auto cursor-pointer"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    下载
                                </button>
                            </div>
                            <div id="file-content" class="w-full bg-card border border-border rounded-xl p-6 sm:p-8 shadow-sm">
                                <div class="text-center py-8 text-muted-foreground">加载中...</div>
                            </div>
                        </div>

                        <!-- 其他页面内容 -->
                        <div id="collection-page" class="content-page hidden">
                            <!-- 采集管理页内容 -->
                            <div class="mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                <h2 class="text-2xl font-semibold bg-gradient-to-r from-slate-900 to-slate-700 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent">采集管理</h2>
                                <div class="flex flex-wrap gap-3">
                                    <button 
                                        id="add-source-btn"
                                        onclick="showAddSourceModal()"
                                        class="inline-flex items-center gap-2 justify-center rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105 h-10 px-4 cursor-pointer"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                        </svg>
                                        添加采集源
                                    </button>
                                    <button 
                                        id="trigger-all-btn"
                                        onclick="triggerCollection()"
                                        class="inline-flex items-center gap-2 justify-center rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-indigo-500 to-purple-600 text-white hover:from-indigo-600 hover:to-purple-700 hover:shadow-lg hover:scale-105 h-10 px-4 cursor-pointer"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                        </svg>
                                        触发全部采集
                                    </button>
                                </div>
                            </div>
                            <div id="sources-list" class="space-y-2">
                                <div class="text-center py-8 text-muted-foreground">加载中...</div>
                            </div>
                        </div>

                        <div id="users-page" class="content-page hidden">
                            <div class="mb-6 flex items-center justify-between">
                                <h2 class="text-2xl font-semibold bg-gradient-to-r from-slate-900 to-slate-700 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent">用户管理</h2>
                            </div>
                            <div id="users-list" class="space-y-2">
                                <div class="text-center py-8 text-muted-foreground">加载中...</div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>

        <!-- 上传文件对话框 -->
        <div id="upload-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
            <div class="bg-card border border-border rounded-xl shadow-2xl w-full max-w-md transform transition-all">
                <div class="p-6 space-y-4 bg-white dark:bg-gray-800 rounded-lg">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-semibold tracking-tight">上传文件</h2>
                        <button 
                            id="close-upload-modal"
                            class="rounded-md p-1 text-muted-foreground hover:text-foreground hover:bg-accent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                            aria-label="关闭"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <form id="upload-form" class="space-y-4" onsubmit="event.preventDefault(); uploadFile();">
                        <div class="space-y-2">
                            <label for="upload-file-input" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                选择文件
                            </label>
                            <div class="relative">
                                <input 
                                    type="file" 
                                    id="upload-file-input" 
                                    accept=".md,.txt,text/*"
                                    required
                                    class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                />
                            </div>
                            <p class="text-xs text-muted-foreground mt-1">支持 Markdown (.md) 和文本文件 (.txt)</p>
                        </div>
                        <div class="space-y-2">
                            <label for="upload-title-input" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                文件标题（可选）
                            </label>
                            <input 
                                type="text" 
                                id="upload-title-input" 
                                placeholder="留空则使用文件名"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                            />
                        </div>
                        <div class="flex gap-2 justify-end pt-2">
                            <button 
                                type="button"
                                id="close-upload-modal-2"
                                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-secondary text-secondary-foreground hover:bg-secondary/80 h-10 px-4"
                            >
                                取消
                            </button>
                            <button 
                                type="submit"
                                id="upload-file-btn"
                                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                上传
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 添加采集源对话框 -->
        <div id="add-source-modal" class="dialog-overlay hidden">
            <div class="dialog-content">
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h2 class="dialog-title">添加采集源</h2>
                        <button 
                            id="close-add-source-modal"
                            onclick="hideAddSourceModal()"
                            class="dialog-close"
                            aria-label="关闭"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <form id="add-source-form" class="space-y-4" onsubmit="event.preventDefault(); createSource();">
                        <div class="space-y-2">
                            <label for="source-name-input" class="label">名称</label>
                            <input 
                                type="text" 
                                id="source-name-input" 
                                placeholder="采集源名称"
                                required
                                class="input"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="source-url-input" class="label">URL模式</label>
                            <input 
                                type="text" 
                                id="source-url-input" 
                                placeholder="https://example.com/**"
                                required
                                class="input"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="source-type-select" class="label">类型</label>
                            <select 
                                id="source-type-select"
                                class="select"
                            >
                                <option value="webpage">网页</option>
                                <option value="video">视频</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label for="source-search-params-input" class="label">
                                搜索参数 (可选，JSON格式)
                                <span class="text-xs text-muted-foreground ml-2">如: {"keyword": "Python", "page": "1"}</span>
                            </label>
                            <textarea 
                                id="source-search-params-input" 
                                placeholder='{"keyword": "Python", "page": "1"}'
                                rows="3"
                                class="textarea font-mono"
                            ></textarea>
                            <p class="text-xs text-muted-foreground">
                                如果填写，系统会先搜索获取结果链接，然后逐个采集。留空则直接采集URL模式指定的页面。
                            </p>
                        </div>
                        <div class="dialog-footer">
                            <button 
                                type="button"
                                id="close-add-source-modal-2"
                                onclick="hideAddSourceModal()"
                                class="btn btn-secondary"
                            >
                                取消
                            </button>
                            <button 
                                type="submit"
                                id="create-source-btn"
                                class="btn btn-primary"
                            >
                                创建
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 编辑采集源对话框 -->
        <div id="edit-source-modal" class="dialog-overlay hidden">
            <div class="dialog-content">
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h2 class="dialog-title">编辑采集源</h2>
                        <button 
                            id="close-edit-source-modal"
                            onclick="hideEditSourceModal()"
                            class="dialog-close"
                            aria-label="关闭"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <form id="edit-source-form" class="space-y-4" onsubmit="event.preventDefault(); updateSource();">
                        <div class="space-y-2">
                            <label for="edit-source-name-input" class="label">名称</label>
                            <input 
                                type="text" 
                                id="edit-source-name-input" 
                                placeholder="采集源名称"
                                required
                                class="input"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="edit-source-url-input" class="label">URL模式</label>
                            <input 
                                type="text" 
                                id="edit-source-url-input" 
                                placeholder="https://example.com/**"
                                required
                                class="input"
                            />
                        </div>
                        <div class="space-y-2">
                            <label for="edit-source-type-select" class="label">类型</label>
                            <select 
                                id="edit-source-type-select"
                                class="select"
                            >
                                <option value="webpage">网页</option>
                                <option value="video">视频</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label for="edit-source-search-params-input" class="label">
                                搜索参数 (可选，JSON格式)
                                <span class="text-xs text-muted-foreground ml-2">如: {"keyword": "Python", "page": "1"}</span>
                            </label>
                            <textarea 
                                id="edit-source-search-params-input" 
                                placeholder='{"keyword": "Python", "page": "1"}'
                                rows="3"
                                class="textarea font-mono"
                            ></textarea>
                        </div>
                        <div class="space-y-2">
                            <label for="edit-source-crawler-config-input" class="label">
                                爬虫配置 (可选，JSON格式)
                                <span class="text-xs text-muted-foreground ml-2">如: {"use_selenium": true}</span>
                            </label>
                            <textarea 
                                id="edit-source-crawler-config-input" 
                                placeholder='{"use_selenium": true, "selectors": {...}}'
                                rows="3"
                                class="textarea font-mono"
                            ></textarea>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input 
                                type="checkbox" 
                                id="edit-source-enabled-checkbox"
                                class="checkbox"
                            />
                            <label for="edit-source-enabled-checkbox" class="label">启用采集源</label>
                        </div>
                        <div class="dialog-footer">
                            <button 
                                type="button"
                                id="close-edit-source-modal-2"
                                onclick="hideEditSourceModal()"
                                class="btn btn-secondary"
                            >
                                取消
                            </button>
                            <button 
                                type="submit"
                                id="update-source-btn"
                                class="btn btn-primary"
                            >
                                更新
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/notifications.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/files.js"></script>
    <script src="/js/collection.js"></script>
    <script src="/js/users.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
